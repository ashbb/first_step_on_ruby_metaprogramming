<html><head><script type="text/javascript" src="/js/code_highlighter.js"></script>
<script type="text/javascript" src="/js/code_highlighter_ruby.js"></script>
<base target="content">
<link rel=StyleSheet href="/css/style.css" type="text/css" nedia=screen>
</head>
<body>
<h1>First Step on Ruby Metaprogramming</h1>

<p><br><br></p>

<hr/>

<h1>First Week</h1>

<p>Let's start learning Ruby Metaprogramming!</p>

<p><br></p>

<h2>Study 0</h2>

<p>1st, review the built-in, read-only variable <b>self</b>. Read the following articles:</p>

<ul>
<li><a href="http://rubylearning.com/satishtalim/ruby_self.html">self</a> - The current/default object</li>
<li><p><a href="../html/self.html">self</a> - Quote from Programming Ruby 1.9</p></li>
<li><p><a href="../html/when_does_self_change.html">When does self change?</a> - Quote from The Ruby Object Model</p></li>
</ul>

<p>2nd, review <b>singleton class</b>. Read the following article:</p>

<ul>
<li><a href="http://pmade.com/articles/2008/ruby-singleton">Understanding Ruby Singleton Classes</a></li>
</ul>

<p>3rd, review the <b>scope of variables</b>. Read the following article:</p>

<ul>
<li><a href="http://www.techotopia.com/index.php/Ruby_Variable_Scope">Ruby Variable Scope</a></li>
</ul>

<p><br></p>

<h2>Study 1</h2>

<p>To learn about the following methods read  <a href="http://www.sapphiresteel.com/The-Book-Of-Ruby">The Book of Ruby</a>, Chapter 20: Dynamic Programming.</p>

<ul>
<li>eval</li>
<li>instance_eval</li>
<li>class_eval (aka: module_eval)</li>
<li>class_variable_set</li>
<li>class_variable_get</li>
<li>class_variables (Try it out: instance_variables)</li>
<li>instance_variable_set (Try it out: instance_variable_get)</li>
<li>define_method</li>
<li>const_set</li>
<li>const_get (Try it out: constants)</li>
<li>Class.new (Try it out: Struct.new)</li>
<li>binding (Try it out: lambda)</li>
<li>send (Try it out: method)</li>
<li>remove_method</li>
<li>undef_method</li>
<li>method_missing</li>
</ul>

<p><br></p>

<h2>Study 2</h2>

<p>Read _why's hacking, <a href="http://whytheluckystiff.net/articles/seeingMetaclassesClearly.html">Seeing Metaclasses Clearly</a> to learn about the following singleton class (metaclass)</p>

<ul>
<li>class &lt;&lt; self; self; end</li>
</ul>

<p><br></p>

<h2>Study 3</h2>

<p>Read Marc-Andre Cournoyer's blog, <a href="http://macournoyer.wordpress.com/2007/07/06/extending-your-include-knowledge-of-ruby/">Extending your include knowledge of Ruby</a> to learn about the following methods to read Marc-Andre Cournoyer's blog, <a href="http://macournoyer.wordpress.com/2007/07/06/extending-your-include-knowledge-of-ruby/">Extending your include knowledge of Ruby</a>. 
Also read Ruby-Doc Core API: <a href="http://www.ruby-doc.org/core/classes/Module.html#M001683">Module#included</a> and <a href="http://www.ruby-doc.org/core/classes/Module.html#M001660">Module#extended</a></p>

<ul>
<li>include</li>
<li>extend</li>
<li>included</li>
<li>extended</li>
</ul>

<p><br></p>

<h2>Before Exercises</h2>

<p>Watch the following presentation, <a href="http://www.rubyinside.com/scotland-on-rails-presentations-now-online-27-awesome-videos-1799.html">the Scotland on Rails conference 2009</a>, by Dave Thomas.</p>

<p><a href="http://scotland-on-rails.s3.amazonaws.com/2A04_DaveThomas-SOR.mp4">The Ruby Object Model</a></p>

<p><br></p>

<h2>Exercises</h2>

<p>Try to do the following exercises. Let's discuss all these exercises in the relevant thread in the First Week Forum.</p>

<ul>
<li><a href="../html/Exercise_1.html">Exercise 1</a>: Get the values from outside the class.</li>
<li><a href="../html/Exercise_2.html">Exercise 2</a>: Add your code to display 'I like metaprogramming!'</li>
<li><a href="../html/Exercise_3.html">Exercise 3</a>: Show lots of ways to define singleton method.</li>
<li><a href="../html/Exercise_4.html">Exercise 4</a>: Glance into Ruby inside with binding method.</li>
<li><a href="../html/Exercise_5.html">Exercise 5</a>: Define the class without <code class="ruby">class</code> and <code class="ruby">def</code>.</li>
</ul>

<p><br></p>

<h2>Watch the video</h2>

<p>Watch the Dave Thomas's presentation about Metaprogramming.</p>

<p><a href="http://www.infoq.com/presentations/metaprogramming-ruby">MetaProgramming - Extending Ruby for Fun and Profit</a></p>

<p>Understand these concepts:</p>

<ul>
<li>Classes are open</li>
<li>Definitions are active</li>
<li>All method calls have a receiver</li>
<li>Classes are objects</li>
</ul>

<p><br></p>

<h2>Cheat Sheet</h2>

<ul>
<li><a href="../html/cheat_sheet.html">Cheat Sheet</a>: a list of Ruby metaprogramming techniques</li>
</ul>

<p><br><br></p>

<hr/>

<h1>Second Week</h1>

<p>Well, let's practice how to write a tiny app with Ruby Metaprogramming techniques.</p>

<p>Note: If you have an idea in your mind. Feel free, please show us and try to do that.   </p>

<p><br></p>

<h2>Assignment 1</h2>

<p>Define class Dog.</p>

<p><br></p>

<h2>Step 1</h2>

<p>There are three dogs named Lassie, Fido and Stimpy.<br/>
Look at <a href="../html/Dog_Step1.html">dog_game.rb</a>. Expected output is the following:</p>

<pre><code class="ruby">"Lassie is dancing"
"Lassie is a smelly doggy!"
"Lassie finds this hilarious!"

"Fido don't understand dance"
"Fido is a smelly doggy!"
"Fido don't understand laugh"

"Stimpy is dancing"
"Stimpy don't understand poo"
"Stimpy don't understand laugh"
</code></pre>

<p>Create <b>dog.rb</b> stored the class Dog.</p>

<p><strong>Hints:</strong></p>

<ul>
<li>class Dog has three methods: initialize, can, method_missing</li>
<li>may be useful to define the static data like this:
MSGS = {:dance => 'is dancing', :poo => 'is a smelly doggy!', :laugh => 'finds this hilarious!'}</li>
</ul>

<p><br></p>

<h2>Step 2</h2>

<p>Challenge: Improve a little bit.   </p>

<p>Look at <a href="../html/Dog_Step2.html">dog_game.rb</a>. Expected output is the following:</p>

<pre><code class="ruby">"Lassie is dancing"
"Lassie is a smelly doggy!"
"Lassie finds this hilarious!"

"Fido don't understand dance"
"Fido is smelly."
"Fido don't understand laugh"

"Stimpy is dancing"
"Stimpy don't understand poo"
"Stimpy don't understand laugh"
"Stimpy cried AHHHH"
</code></pre>

<p>Let's improve <b>dog.rb</b>.</p>

<p><strong>Hints:</strong></p>

<ul>
<li>use <b>can</b> method <b>with block</b> like this: <b>stimpy.can(:cry){"#{name} cried AHHHH"}</b></li>
<li>define the <b>name</b> method</li>
</ul>

<p><br></p>

<p><br></p>

<h2>Assignment 2</h2>

<p>Follow these steps to create a tiny XML generator: <b>xml.rb</b></p>

<p>We can use it like this:</p>

<ul>
<li>Look at <a href="../html/sample_html.html">sample_html.rb</a></li>
<li>Need to write <b>XML</b> class with <b>xml_generate()</b> method.</li>
<li>Line 9-22 is our tiny DSL code to create the output (xml format text). It'll be stored to <b>sample_twitters.html</b> file at the last line.</li>
<li>Line 4-6 is the input data, just a sample for this practice.</li>
<li>Look at the output: <a href="../html/sample_twitters_html.html">sample_twitters.html</a> and a <a href="../imgs/sample_screenshot.png">screenshot</a>.</li>
</ul>

<p><br></p>

<h2>Step 1</h2>

<p>Let's start!<br/>
Create two files: <b>sample_html.rb</b> and <b>xml.rb</b></p>

<p><b>sample_html.rb</b> has the following features.</p>

<ul>
<li>create a XML object</li>
<li>call <b>xml_generate()</b> method</li>
<li>at first, the input is only one line: <b>content "Let's start!"</b></li>
<li>store the output (created xml)</li>
</ul>

<p><br></p>

<p><b>xml.rb</b> has the following three instance methods.</p>

<ul>
<li>initialize</li>
<li>content</li>
<li>xml_generate</li>
</ul>

<p><br></p>

<p><b>Hint:</b> instance_eval</p>

<p><br></p>

<p>Look at the <a href="../html/XML_Step1.html">input and output</a> for Step 1.</p>

<p><br></p>

<h2>Step 2</h2>

<p>Improve to accept the following inputs.</p>

<pre><code class="ruby">html do
  body do
    content "Let's start!"
  end
end
</code></pre>

<p><br></p>

<p><b>Hint:</b> method_missing</p>

<p><br></p>

<p>Look at the <a href="../html/XML_Step2.html">input and output</a> for Step 2.</p>

<p><br></p>

<h2>Step 3</h2>

<p>Improve to accept the following inputs.</p>

<pre><code class="ruby">html do
  body do
    content "Let's start!"
    form :action =&gt; '/page', :method =&gt; 'post' do
      input :type =&gt; 'text', :name =&gt; 'str', :maxlength =&gt; 3, :size =&gt; 3
      input :type =&gt; 'submit', :value =&gt; 'page'
    end
  end
end
</code></pre>

<p><br></p>

<p><b>Hint:</b> hash</p>

<p><br></p>

<p>Look at the <a href="../html/XML_Step3.html">input and output</a> for Step 3.</p>

<p><br></p>

<h2>Step 4</h2>

<p>Improve to accept the following inputs.<br/>
Use <a href="../imgs/b-satoshi.jpg">this pic</a> as a avatar.</p>

<pre><code class="ruby">html do
  body do
    twitters.each do |tw|
      img :src =&gt; tw.avatar, :alt =&gt; tw.name, :width =&gt; 25, :height =&gt; 25
      content [" : " , tw.text]
      br
      br
    end
    form :action =&gt; '/page', :method =&gt; 'post' do
      input :type =&gt; 'text', :name =&gt; 'str', :maxlength =&gt; 3, :size =&gt; 3
      input :type =&gt; 'submit', :value =&gt; 'page'
    end
  end
end
</code></pre>

<p><br></p>

<p><b>Hint:</b> no need to use any more metaprogramming tech.</p>

<p><br></p>

<p>Look at the <a href="../html/XML_Step4.html">input and output</a> for Step 4.</p>

<p><br></p>

<h2>Step 5</h2>

<p>We want to replace <b>XML.new.xml_generate</b> to <b>XML.generate</b>.</p>

<p><br></p>

<p><b>Hint:</b> define class method</p>

<p><br></p>

<p><b>Let's discuss your code in the relevant thread in the Second Week Forum.</b></p>

<p><br></p>

<h1>For More Study</h1>

<p>Try to hack the Sample Apps on <a href="http://github.com/ashbb/ruby_metaprogramming_study_note/tree/master">Ruby Metaprogramming Study Note</a></p>

<p><br></p>

<h2>Interesting Articles</h2>

<ul>
<li><p><a href="http://technicalpickles.com/posts/using-method_missing-and-respond_to-to-create-dynamic-methods">Using method<em>missing and respond</em>to? to create dynamic methods</a></p></li>
<li><p><a href="http://ola-bini.blogspot.com/search/label/metaprogramming">Ola Bini's blogs on Meta programming</a></p></li>
<li><p><a href="http://www.rootr.net/rubyfaq.html">The Ruby Language FAQ</a></p></li>
</ul>

<p><br></p>

<h2>Note</h2>

<p>There are a few more useful hook methods for metaprogramming.</p>

<ul>
<li>inherited</li>
<li>method_added</li>
</ul>

<p>I'd like to exercise them at the next batch. ;-)</p>

<p><br><br></p>

<hr/>

<p>2009.7.6 Satoshi Asakawa</p></body></html>
